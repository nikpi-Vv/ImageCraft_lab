***ImageCraft*** - это консольная программа на языке C, предназначенная для применения цепочки графических фильтров к 24-битным BMP-изображениям без сжатия.

Для компиляции gcc -o ic.exe image_crafter.c bmp_tools.c filter_tools.c filters.c -Im \
Для мозайки скачать CIFAR-100 binary version (suitable for C programs) - https://www.cs.toronto.edu/~kriz/cifar.html \
Формат команды в командной строке: ./<exe_file> <input_file> <output_file> <filter_1> <filter_>...

***Структура проекта***

bmp_tools.h/c — работа с BMP-файлами \
filter_tools.h/c — парсинг и управление фильтрами \
filters.h/c — реализация всех фильтров \
image_craft.c — точка входа (main)

***image_craft***

| Название функции | Принимаемые параметры | Назначение | Вывод |
| :---: | :---: | :---: | :---: |
| is_bmp_file  | Указатель на строку с именем файла (может быть NULL) | Проверяет, что имя файла заканчивается расширением .bmp (регистронезависимо) | 1, если расширение .bmp; иначе 0 |
| print_usage | - | Выводит справку по использованию программы | void |
| main | Аргументы командной строки | Парсит входные файлы и фильтры, загружает изображение, применяет фильтры, сохраняет результат | 0 при успехе, 1 при ошибке |

***bmp_tools***

| Название функции | Принимаемые параметры | Назначение | Вывод |
| :---: | :---: | :---: | :---: |
| read_uint32 | Указатель на 4 байта | Читает little-endian uint32 из массива | unsigned int |
| read_int32 | Указатель на 4 байта | Читает little-endian int32 из массива | int |
| read_uint16 | Указатель на 2 байта | Читает little-endian uint16 из массива | unsigned short |
| parse_bmp_image | Путь к BMP-файлу | Загружает и проверяет BMP (24-bit, без сжатия, BITMAPINFOHEADER) | Указатель на BMP_Image* или NULL |
| free_bmp_image | Указатель на изображение | Освобождает всю память: заголовки, сырые данные, пиксели | void |
| parse_pixel_data | Указатель на изображение | Конвертирует сырые BMP-данные в массив Pixel (RGB, top-down) с учётом направления строк | void |
| serialize_pixel_data | Указатель на изображение | Конвертирует Pixel в сырые BMP-данные (BGR, bottom-up, с паддингом) | void |
| save_bmp_image | Путь и указатель на изображение | Сохраняет изображение в BMP-файл | 1 при успехе, 0 при ошибке |

***filter_tools***

| Название функции | Принимаемые параметры | Назначение | Вывод |
| :---: | :---: | :---: | :---: |
| is_positive_integer | Вещественное число | Проверяет, является ли значение положительным целым | 1 если да, 0 если нет |
| parse_filters | Аргументы командной строки, стартовый индекс, указатель на список | Парсит фильтры, строит связный список FilterNode, проверяет тип и диапазон параметров | 1 при успехе, 0 при ошибке |
| string_duplicate | Указатель на строку в формате C (const char*) | Создаёт динамическую копию входной строки | Указатель на новую строку (char*), или NULL, если входная строка — NULL или не хватило памяти |
| create_filter_node | Имя фильтра, параметры, их количество | Выделяет и инициализирует узел списка фильтров | Указатель на FilterNode* или NULL |
| free_filter_list | Голова списка фильтров | Рекурсивно освобождает весь список фильтров | void |


***filters***

| Название функции | Принимаемые параметры | Назначение | Вывод |
| :---: | :---: | :---: | :---: |
| apply_filters | Указатель на изображение в формате BMP_Image и список фильтров | Последовательно применяет все фильтры к изображению | void |
| filter_crop | Указатель на изображение в формате BMP_Image, ширина, высота | Обрезает изображение до указанного размера (верхний левый угол) | void |
| filter_grayscale | Указатель на изображение в формате BMP_Image | Преобразует в оттенки серого по формуле Y = 0.299·R + 0.587·G + 0.114·B | void |
| filter_negative | Указатель на изображение в формате BMP_Image | Инвертирует цвета: R' = 255 − R и т.д.b | void |
| filter_sharpen | Указатель на изображение в формате BMP_Image | Применяет фиксированное линейное ядро повышения резкости [0 -1 0; -1 5 -1; 0 -1 0] к каждому пикселю с клиппингом границ и ограничением значений в диапазон [0, 255] | void |
| filter_edge | Указатель на изображение в формате BMP_Image, порог | Выделяет границы: серый - лапласиан - бинаризация | void |
| filter_median | Указатель на изображение в формате BMP_Image | Медианный фильтр через гистограмму (подавление "соли и перца") | void |
| filter_gaussian_blur | Указатель на изображение в формате BMP_Image, размер окна | Применяет разделимое box-размытие (усреднение по окну) | void |
| filter_glass | Указатель на изображение в формате BMP_Image, радиус | Искажает изображение случайным смещением в пределах радиуса | void |
| filter_crystallize | Указатель на изображение в формате BMP_Image, размер ячейки | Создаёт блоки усреднённого цвета заданного размера | void |
| filter_mosaic_cifar | Указатель на изображение в формате BMP_Image | Собирает изображение из маленьких картинок CIFAR-100, подбирая по среднему цвету | void |
| load_dataset | Путь к train.bin | Загружает датасет CIFAR-100 в память | Указатель на CIFAR_Dataset* или NULL |
| free_dataset | Указатель на датасет | Освобождает память, выделенную под датасет | void |
| color_distance | Две тройки цветовых компонентов (R, G, B) в диапазоне [0, 255] | Вычисляет квадрат евклидова расстояния между двумя цветами в RGB-пространстве | Значение типа double — квадрат расстояния между цветами (без извлечения корня для повышения производительности) |

***Список фильтров и правила их применения***

| Название фильтра | Принимаемые параметры | Назначение | Вывод |
| :---: | :---: | :---: | :---: |
| -crop | Два целых положительных числа: ширина, высота | Зависит от исходного размера | Обрезает изображение до указанного размера (верхний левый угол) |
| -gs | - | - | Преобразует изображение в оттенки серого по формуле: 0.299·R + 0.587·G + 0.114·B |
| -neg | - | - | Инвертирует цвета: каждый канал заменяется на 255 − значение |
| -sharp | - | - | Повшает резкость через ядро [0 -1 0; -1 5 -1; 0 -1 0] |
| -edge | Одно вещественное ∈ [0.0, 1.0]: порог | 0.1 - 0.3 | Выделяет границы: преобразует в серый, применяет лапласиан, бинаризует |
| -med | Одно целое ≥ 1: размер окна | 3, 5, 7 | Медианный фильтр: удаляет импульсный шум ("соль и перец") |
| -blur | Одно вещественное > 0: сигма | 0.5 - 3.0 | Размывает изображение с помощью разделимого box-фильтра |
| -glass | Одно вещественное > 0: радиус | 2.0 - 6.0 | Искажает изображение, как через стекло (случайное смещение пикселей) |
| -crystallize | Одно целое >= 1: размер блока | 10 - 50 | Создаёт "кристаллы": разбивает изображение на блоки, заполняет усреднённым цветом |
| -mosaic | - | - | Собирает исходное изображение из маленьких картинок, подбирая их по среднему цвету блока |

